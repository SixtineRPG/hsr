<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Kanban Firebase Realtime DB</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 1em;}
    .column { margin-bottom: 2em; }
    .cards { list-style: none; padding-left: 0; }
    .cards li { padding: 0.5em; border: 1px solid #ccc; margin-bottom: 0.5em; }
  </style>
</head>
<body>

  <h1>Kanban Firebase Realtime DB</h1>

  <div id="columnsContainer"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDjMvnPebLgJGUlgJm6_jU19FOfRYYwoK8",
      authDomain: "hsr-tracker-26c18.firebaseapp.com",
      databaseURL: "https://hsr-tracker-26c18-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hsr-tracker-26c18",
      storageBucket: "hsr-tracker-26c18.firebasedatabase.app",
      messagingSenderId: "202249444604",
      appId: "1:202249444604:web:4cb7cb6ccb218f27c74b79"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const columnsContainer = document.getElementById('columnsContainer');

    function renderBoard(board) {
      if (!board || !board.columns) {
        console.warn('board ou board.columns non défini');
        columnsContainer.innerHTML = '<p>Pas de données disponibles.</p>';
        return;
      }

      columnsContainer.innerHTML = '';

      for (const [colKey, colData] of Object.entries(board.columns)) {
        const colDiv = document.createElement('div');
        colDiv.className = 'column';

        const title = document.createElement('h2');
        title.textContent = colData.title || colKey;
        colDiv.appendChild(title);

        const ulCards = document.createElement('ul');
        ulCards.className = 'cards';

        if (colData.cards) {
          for (const [cardId, card] of Object.entries(colData.cards)) {
            const li = document.createElement('li');
            li.textContent = card.text || "(vide)";
            ulCards.appendChild(li);
          }
        }

        colDiv.appendChild(ulCards);
        columnsContainer.appendChild(colDiv);
      }
    }

    // Ecoute les données en temps réel
    db.ref('board').on('value', snapshot => {
      let board = snapshot.val();

      if (!board || !board.columns) {
        board = {
          columns: {
            todo: { title: "À faire", cards: {
              "1": { text: "Créer le projet Firebase" },
              "2": { text: "Faire la maquette du board" }
            }},
            inprogress: { title: "En cours", cards: {} },
            done: { title: "Fait", cards: {} }
          }
        };
        // Initialisation dans la BDD
        db.ref('board').set(board);
      }

      renderBoard(board);
    });
  </script>

</body>
</html>
